name: Project Secret Command TestSuite
vars:
  cds_project: "ITV2CLISECRET"
testcases:
- name: create project
  steps:
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} user me --format json"
    vars:
      cds_user:
        from: result.systemoutjson
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} project remove --force {{.input.cds_project}}"
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} group remove --force {{.input.cds_project}}"
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} group add {{.input.cds_project}}"

  # Create the project
  - script: >
      {{.cdsctl}} -f {{.cdsctl.config}} project create {{.input.cds_project}} "Test Project {{.input.cds_project}}" {{.input.cds_project}}

- name: add new secret
  steps:
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret add ITV2CLISECRET mySecretName myValue"

- name: list secrets
  steps:
    - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret list ITV2CLISECRET --format json"
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldContainSubstring "mySecretName"

- name: remove secret
  steps:
    - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret delete ITV2CLISECRET mySecretName --force"
