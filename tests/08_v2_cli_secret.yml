name: Project Secret Command TestSuite
vars:
  cds_project: "ITV2CLISECRET"
testcases:
- name: create project
  steps:
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} user me --format json"
    vars:
      cds_user:
        from: result.systemoutjson
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} project remove --force {{.cds_project}}"
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} group remove --force {{.cds_project}}"
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} group add {{.cds_project}}"

  # Create the project
  - script: >
      {{.cdsctl}} -f {{.cdsctl.config}} project create {{.cds_project}} "Test Project {{.cds_project}}" {{.cds_project}}

- name: add new secret
  steps:
  - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret add {{.cds_project}} mySecretName myValue"

- name: list secrets
  steps:
    - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret list {{.cds_project}} --format json"
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldContainSubstring "mySecretName"

- name: remove secret
  steps:
    - script: "{{.cdsctl}} -f {{.cdsctl.config}} experimental project secret delete {{.cds_project}} mySecretName --force"
