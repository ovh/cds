name: Project Secret Command TestSuite
vars:
  cds_project: "ITV2CLISECRET"
testcases:
- name: create project
  steps:
  - script: "{{.input.cdsctl_command}} user me --format json"
    vars:
      cds_user:
        from: result.systemoutjson
  - script: "{{.input.cdsctl_command}} project remove --force {{.input.cds_project}}"
  - script: "{{.input.cdsctl_command}} group remove --force {{.input.cds_project}}"
  - script: "{{.input.cdsctl_command}} group add {{.input.cds_project}}"

  # Create the project
  - script: >
      {{.input.cdsctl_command}} project create {{.input.cds_project}} "Test Project {{.input.cds_project}}" {{.input.cds_project}}

- name: add new secret
  steps:
  - script: {{.input.cdsctl_command}} experimental project secret add ITV2CLISECRET mySecretName myValue

- name: list secrets
  steps:
    - script: {{.input.cdsctl_command}} experimental project secret list ITV2CLISECRET --format json
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldContainSubstring "mySecretName"

- name: remove secret
  steps:
    - script: {{.input.cdsctl_command}} experimental project secret delete ITV2CLISECRET mySecretName --force
