<form class="ui form">
    <div class="ui segment">
        <div class="field">
            <div class="fields">
                <div class="seven wide inline field">
                    <label>{{'common_name' | translate}}</label>
                    <input *ngIf="edit" type="text" name="actionName" [(ngModel)]="editableAction.name" (keydown)="editableAction.hasChanged = true">
                    <span *ngIf="!edit" class="inline">{{editableAction.name}}</span>
                </div>
                <div class="seven wide inline field">
                    <label class="labelPadding">{{'common_description' | translate}}</label>
                    <textarea [disabled]="!edit" name="actionDescription" [(ngModel)]="editableAction.description" rows="{{getDescriptionHeight(editableAction.description)}}" (keydown)="editableAction.hasChanged = true"></textarea>
                </div>
                <div class="two wide right aligned field labelPadding">
                    <a class="pointing" (click)="requirementModal.show({inverted: true})">{{ editableAction.requirements.length + ' '}}{{ 'common_requirements' | translate }}</a>
                    <sm-modal class="large" title="{{ 'common_requirements' | translate }}" #requirementModal>
                        <modal-content>
                            <div class="ui form">
                                <div class="field">
                                    <app-requirements-list [requirements]="editableAction.requirements" [edit]="edit" (event)="requirementEvent($event)"></app-requirements-list>
                                    <div class="requirementForm" *ngIf="edit">
                                        <app-requirements-form (event)="requirementEvent($event)"></app-requirements-form>
                                    </div>
                                </div>
                            </div>
                        </modal-content>
                        <modal-actions>
                            <button class="ui grey button" (click)="requirementModal.hide()">{{ 'common_close' | translate }}</button>
                        </modal-actions>
                    </sm-modal>
                </div>
            </div>
        </div>
    </div>
    <div class="ui segment" *ngIf="editableAction.type !== 'Joined'">
        <div class="field">
            <label>{{ 'common_parameters' | translate }}</label>
            <div>
                <app-parameter-list [project]="project" [parameters]="editableAction.parameters" (event)="parameterEvent($event)"></app-parameter-list>
            </div>
            <div>
                <app-parameter-form [project]="project"  (createParameterEvent)="parameterEvent($event)"></app-parameter-form>
            </div>
        </div>
    </div>

    <div class="ui segment">
    <h2>{{ 'action_step_title' | translate }}</h2>
    <div class="dragula-container" [dragula]="'bag-one'" [dragulaModel]="editableAction.actions" *ngIf="editableAction">
        <div *ngFor="let step of editableAction.actions" class="step">
            <div class="ui form">
                <div class="inline fields">
                    <div class="eight wide field paramName">
                        <i class="move icon" *ngIf="edit"></i>{{step.name}}
                    </div>
                    <div class="right aligned four wide field">
                        <div style="width: 100%;">
                            <div class="ui toggle checkbox" *ngIf="edit">
                                <input type="checkbox" name="enabled" [(ngModel)]="step.enabled" (change)="editableAction.hasChanged = true">
                                <label>{{ 'common_enable' | translate }}</label>
                            </div>
                        </div>
                        <ng-container *ngIf="!edit">
                            <ng-container *ngIf="step.enabled">{{ 'common_enabled_f' | translate }}</ng-container>
                            <ng-container *ngIf="!step.enabled">{{ 'common_disabled_f' | translate }}</ng-container>
                        </ng-container>
                    </div>
                    <div class="right aligned four wide field">
                        <div style="width: 100%;">
                            <div class="ui toggle checkbox" *ngIf="edit">
                                <input type="checkbox" name="final" [(ngModel)]="step.final" (change)="editableAction.hasChanged = true">
                                <label>{{ 'step_final' | translate }}</label>
                            </div>
                        </div>
                    </div>
                    <div class="right aligned four wide field" *ngIf="edit">
                        <div style="width: 100%;">
                            <app-delete-button (event)="removeStep(step)"></app-delete-button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui aligned grid" *ngFor="let p of step.parameters">
                <div class="column">
                    <label><b>{{p.name + ' :'}}</b></label>
                    <app-parameter-value [edit]="edit" [project]="project" [type]="p.type" [(value)]="p.value" (valueUpdating)="editableAction.hasChanged = true"></app-parameter-value>
                </div>
            </div>
            <hr>
        </div>
    </div>
    <div class="ui form" *ngIf="edit">
        <div class="fields">
            <div class="field">
                <sm-select name="step" class="search" (onChange)="selectPublicAction($event)">
                    <option *ngFor="let a of publicActions" value="{{a.name}}">{{a.name}}</option>
                </sm-select>
            </div>
            <div class="field">
                <button name="addstepbtn" class="ui left floated blue button" (click)="addStep()"><i class="plus icon"></i>{{ 'job_add_step' | translate }}</button>
            </div>

        </div>
    </div>


    <div class="right aligned field" *ngIf="edit">
        <button name="updatebtn" class="ui green button" *ngIf="editableAction.hasChanged" (click)="sendActionEvent('update')"><i class="save icon"></i>{{ 'job_save' | translate }}</button>
        <app-delete-button *ngIf="!editableAction.hasChanged" (event)="sendActionEvent('delete')"></app-delete-button>
    </div>

    </div>
</form>
