<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	<meta charset="utf-8">
<title>Worker Model OpenStack - CDS - Continuous Delivery Service</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="https://ovh.github.io/cds/images/favicon.png">




<link rel="stylesheet" href="https://ovh.github.io/cds/sass/styles.css" integrity="" media="screen">
<link rel="stylesheet" href="https://ovh.github.io/cds/css/auto-complete.css">
<link rel="stylesheet" href="https://ovh.github.io/cds/css/fontawesome.min.css">
<link rel="stylesheet" href="https://ovh.github.io/cds/css/asciinema-player.css">
<link rel="stylesheet" href="https://ovh.github.io/cds/css/solarized-light.css">

<meta name="description" content="CDS build using OVH.com OpenStack infrastructure
Create OpenStack user In OVH manager, in cloud section, click on the menu on the Servers&gt;OpenStack item.
You will be able to create a worker model OpenStack user, enter description (name and password will be generated).
Add OpenStack worker model We need to define an OpenStack worker model to have OpenStack hatchery booting workers.
We will create a model called testopenstack:
 With low hardware capacity (vps-ssd-1) On Debian 8 With Docker ready to use Git installed  You need to configure:">
<meta property="og:description" content="CDS build using OVH.com OpenStack infrastructure
Create OpenStack user In OVH manager, in cloud section, click on the menu on the Servers&gt;OpenStack item.
You will be able to create a worker model OpenStack user, enter description (name and password will be generated).
Add OpenStack worker model We need to define an OpenStack worker model to have OpenStack hatchery booting workers.
We will create a model called testopenstack:
 With low hardware capacity (vps-ssd-1) On Debian 8 With Docker ready to use Git installed  You need to configure:">
<meta name="twitter:description" content="CDS build using OVH.com OpenStack infrastructure
Create OpenStack user In OVH manager, in cloud section, click on the menu on the Servers&gt;OpenStack item.
You will be able to create a worker model OpenStack user, enter description (name and password will be generated).
Add OpenStack worker model We need to define an OpenStack worker model to have OpenStack hatchery booting workers.
We will create a model called testopenstack:
 With low hardware capacity (vps-ssd-1) On Debian 8 With Docker ready to use Git installed  You need to configure:">
<meta property="og:url" content="https://ovh.github.io/cds/docs/tutorials/worker_model-openstack/">
<meta property="og:title" content="Worker Model OpenStack">
<meta name="twitter:title" content="Worker Model OpenStack">
<meta name="twitter:image:alt"   content="CDS - Continuous Delivery Service">
<meta property="og:image" content="/images/cds-transparent.png">
<script type="text/javascript" src="https://ovh.github.io/cds/js/anchor-4.1.1.min.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/jquery-ui-1.12.1.min.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/bootstrap-3.3.7.min.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/script.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/lunr.min.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/ovh.github.io\/cds";
</script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/auto-complete.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/search.js"></script>
<script type="text/javascript" src="https://ovh.github.io/cds/js/asciinema-player.js"></script>

	</head>
	<body>
		<section id="hero" class="light-text no-sub">
			<a href="https://ovh.github.io/cds/" class="logo"></a>
			<i id="tocburger" class="fa fa-bars" onclick='$("#toc").toggle()'></i><div class="nav-buttons" data-auto-burger="primary">
				<ul class="global-nav">
					
					
					<li><a href="https://ovh.github.io/cds/docs/" class="active">Documentation</a></li>
					
					<li><a href="https://ovh.github.io/cds/hosting/">Hosting your own instance</a></li>
					
					<li><a href="https://ovh.github.io/cds/development/">CDS Developer Manual</a></li>
					
					<li><a href="https://ovh.github.io/cds/about/">About</a></li>
					
					<li><i class="fa fa-search" onclick='$("#searchbox").toggle(); $("#search-query").focus().select()'></i></li>
					<li>
						<div id="btn-gh">
							<a class="github-button" href="https://github.com/ovh/cds" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star CDS on GitHub">Star</a>
							<script async defer src="https://buttons.github.io/buttons.js"></script>
						</div>
					</li>
				</ul>
				<div id="searchbox">
					<input data-search-input id="search-query" type="text" placeholder="search...">
					<span data-search-clear=""><i class="fa fa-close"></i></span>
				</div>
			</div>

<div id="headSubMenu" class="light-text">




	

		

		
		<ul>
			
			
			
			<li><a href="https://ovh.github.io/cds/docs/">Home</a></li>
			
			
				
				<li><a href="https://ovh.github.io/cds/docs/concepts/">Concepts</a></li>
			
				
				<li><a href="https://ovh.github.io/cds/docs/actions/">Actions</a></li>
			
				
				<li><a href="https://ovh.github.io/cds/docs/components/">Components</a></li>
			
				
				<li><a href="https://ovh.github.io/cds/docs/integrations/">Integrations</a></li>
			
				
				<li><a href="https://ovh.github.io/cds/docs/tutorials/" class="menuSelected">Tutorials</a></li>
			
		</ul>
		
	

	

		

		
	

	

		

		
	

	

		

		
	

</div>


		</section>
		<section id="page-content-with-menu">
			
<div id="toc">
     <div class="toc-container">
        
        
        
        
        
            
                
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                                    
                                    
                            
                        
                    
                
            
        
            
                
                    
                        
                    
                
            
        
            
                
                    
                        
                    
                        
                    
                        
                    
                
            
        
            
                
                    
                
            
        
        
        <i class="fa fa-bars" id="tocburger" onclick='$("#toc").toggle()'></i> 
<a class="item" data-title="Tutorials" href="https://ovh.github.io/cds/docs/tutorials/"></a>

	
	
	
	
		
			
<a class="item" data-title="Check npm vulnerabilities" href="https://ovh.github.io/cds/docs/tutorials/step_by_step_npm_vulnerabilities/"></a>

		
	
		
			
<a class="item" data-title="Init a CDS Workflow from a repository" href="https://ovh.github.io/cds/docs/tutorials/init_workflow_with_cdsctl/"></a>

		
	
		
			
<a class="item" data-title="Import a CDS Workflow from a repository" href="https://ovh.github.io/cds/docs/tutorials/import_workflow_with_webui/"></a>

		
	
		
			
<a class="item" data-title="Service Requirement NGINX" href="https://ovh.github.io/cds/docs/tutorials/service-requirement-nginx/"></a>

		
	
		
			
<a class="item" data-title="Build &amp; Deploy a standard application" href="https://ovh.github.io/cds/docs/tutorials/step_by_step_build_deploy/"></a>

		
	
		
			
<a class="item" data-title="Service Requirement PostgreSQL" href="https://ovh.github.io/cds/docs/tutorials/service-requirement-pg/"></a>

		
	
		
			
<a class="item" data-title="Build, tag and release an application" href="https://ovh.github.io/cds/docs/tutorials/step_by_step_build_tag_release/"></a>

		
	
		
			
<div class="item" data-title="Worker Model Docker">
	<div class="container">
		
		<a class="item" data-title="Worker Model Docker" href="https://ovh.github.io/cds/docs/tutorials/worker_model-docker/"></a>
		
		
	
	
	
	
		
			
<a class="item" data-title="With your own Docker image" href="https://ovh.github.io/cds/docs/tutorials/worker_model-docker/docker-customized/"></a>

		
	

	</div>
</div>

		
	
		
			
<a class="item" data-title="Worker Model OpenStack" href="https://ovh.github.io/cds/docs/tutorials/worker_model-openstack/"></a>

		
	
		
			
<a class="item" data-title="Worker Model vSphere" href="https://ovh.github.io/cds/docs/tutorials/worker_model-vsphere/"></a>

		
	





     </div>
</div>


			<div id="docsContent">
        		

<h1>Worker Model OpenStack</h1>



<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#create-openstack-user">Create OpenStack user</a></li>
<li><a href="#add-openstack-worker-model">Add OpenStack worker model</a></li>
</ul></li>
</ul>
</nav>



<p>CDS build using OVH.com OpenStack infrastructure</p>

<h2 id="create-openstack-user">Create OpenStack user</h2>

<p>In OVH manager, in <a href="https://www.ovh.com/manager/cloud">cloud section</a>, click on the menu on the <em>Servers&gt;OpenStack</em> item.</p>

<p>You will be able to create a worker model OpenStack user, enter description (name and password will be generated).</p>

<h2 id="add-openstack-worker-model">Add OpenStack worker model</h2>

<p>We need to define an OpenStack worker model to have OpenStack hatchery booting workers.</p>

<p>We will create a model called testopenstack:</p>

<ul>
<li>With low hardware capacity (vps-ssd-1)</li>
<li>On Debian 8</li>
<li>With Docker ready to use</li>
<li>Git installed</li>
</ul>

<p>You need to configure:</p>

<ul>
<li><strong>The image</strong> is your image on which you want to spawn your OpenStack VM</li>
<li><strong>The flavor</strong> of your OpenStack VM</li>
<li><strong>Pattern</strong>: if you aren&rsquo;t an administrator you have to choose a configuration pattern in order to fill pre command, worker command and post command with a <a href="https://ovh.github.io/cds/docs/concepts/worker-model/patterns/">pattern that an administrator have already fill for you</a>.</li>
<li>If you are an administrator:

<ul>
<li><strong>pre worker command</strong>: all scripts that need to be run before execute the worker binary (for example: set the right environment variables, install curl and other tools you need like Docker, &hellip;)</li>
<li><strong>main worker command</strong>: the command launched to run the worker with right flags thanks to the interpolate variables that CDS fill for you <a href="https://ovh.github.io/cds/docs/concepts/worker-model/variables/">(more informations click here)</a>.</li>
<li><strong>post worker command</strong>: the command launched after the execution of your worker. If you need to clean something and then shutdown the VM.</li>
</ul></li>
</ul>

<p>Via UI (inside settings section &ndash;&gt; worker models):</p>

<p>For example:</p>

<p><img src="https://ovh.github.io/cds/images/worker_model_openstack.png" alt="Worker Model UI OpenStack" /></p>

<p>Or via CLI with a yaml file:</p>

<pre><code class="language-bash">$ cds worker model import my_worker_model.yml
</code></pre>

<pre><code class="language-yaml">name: testopenstack
type: openstack
description: &quot;my worker model&quot;
group: shared.infra
image: &quot;Debian 7&quot;
flavor: vps-ssd-1
pre_cmd: |
  #!/bin/bash
  set +e
  # Basic build binaries
  cd $HOME
  apt-get -y --force-yes update &gt;&gt; /tmp/user_data 2&gt;&amp;1
  apt-get -y --force-yes install curl git &gt;&gt; /tmp/user_data 2&gt;&amp;1
  apt-get -y --force-yes install binutils &gt;&gt; /tmp/user_data 2&gt;&amp;1
  # Docker installation (FOR DEBIAN)
  if [[ &quot;x{{.FromWorkerImage}}&quot; = &quot;xtrue&quot; ]]; then
    echo &quot;$(date) - CDS_FROM_WORKER_IMAGE == true - no install docker required &quot;
  else
    # Install Docker
    apt-get install -y --force-yes apt-transport-https ca-certificates &gt;&gt; /tmp/user_data 2&gt;&amp;1
    apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
    mkdir -p /etc/apt/sources.list.d
    sh -c &quot;echo deb https://apt.dockerproject.org/repo debian-jessie main &gt; /etc/apt/sources.list.d/docker.list&quot;
    apt-get -y --force-yes update &gt;&gt; /tmp/user_data 2&gt;&amp;1
    apt-cache policy docker-engine &gt;&gt; /tmp/user_data 2&gt;&amp;1
    apt-get install -y --force-yes docker-engine &gt;&gt; /tmp/user_data 2&gt;&amp;1
    service docker start &gt;&gt; /tmp/user_data 2&gt;&amp;1
    # Non-root access
    groupadd docker &gt;&gt; /tmp/user_data 2&gt;&amp;1
    gpasswd -a ${USER} docker &gt;&gt; /tmp/user_data 2&gt;&amp;1
    service docker restart &gt;&gt; /tmp/user_data 2&gt;&amp;1
  fi;
  curl -L &quot;{{.API}}/download/worker/linux/$(uname -m)&quot; -o worker --retry 10 --retry-max-time 120 -C - &gt;&gt; /tmp/user_data 2&gt;&amp;1
  chmod +x worker

cmd: &quot;./worker --api={{.API}} --token={{.Token}} --basedir={{.BaseDir}} --model={{.Model}} --name={{.Name}} --hatchery={{.Hatchery}} --hatchery-name={{.HatcheryName}} --insecure={{.HTTPInsecure}} --single-use --force-exit&quot;

post_cmd: sudo shutdown -h now

</code></pre>




			</div>
		</section><footer>
			<main>
			<a href="https://www.ovh.com"><img src="https://ovh.github.io/cds/images/logo-ovh-white-72DPI.png"></a>
			<div>
				The CDS logos are copyrighted.
				Icons made by <a href="https://www.flaticon.com/authors/eucalyp">Eucalyp</a> 
				from <a href="https://www.flaticon.com/">www.flaticon.com</a>
			</div>
			</main>
		</footer>

	</body>
</html>
