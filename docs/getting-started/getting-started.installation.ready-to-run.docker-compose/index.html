<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.20.6" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="https://ovh.github.com/cds/images/favicon.png" type="image/x-icon" />

    
    <title>Docker Compose :: CDS Documentation</title>
    <link href="https://ovh.github.com/cds/css/nucleus.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/hybrid.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/featherlight.min.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/horsey.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/theme.css" rel="stylesheet">
    <link href="https://ovh.github.com/cds/css/hugo-theme.css" rel="stylesheet">
    <link rel="stylesheet" href="https://ovh.github.com/cds/css/bootstrap.min.css">
    <script src="https://ovh.github.com/cds/js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/getting-started/getting-started.installation.ready-to-run.docker-compose/">
    
<nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
       
	<p><img src="https://ovh.github.com/cds/images/cds-transparent.png?width=40px" alt="CDS" /></p>
 


    </div>
    
  </div>

  <div class="highlightable">
    <ul class="topics">
        

        
        
        
        
            
    
    

    <li data-nav-id="/getting-started/getting-started/" class="dd-item 
     
    parent">
        <a href="https://ovh.github.com/cds/getting-started/getting-started/">
            Getting started
            
        </a>
        
            
            
            
                <ul>
                
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.about-cds/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.about-cds/">
            About CDS
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.concepts/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.concepts/">
            Concepts
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation/" class="dd-item 
     
    parent">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation/">
            Installation
            
        </a>
        
            
            
            
                <ul>
                
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.requirements/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.requirements/">
            Requirements
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.download/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.download/">
            Download
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.configuration/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.configuration/">
            Configuration
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.database/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.database/">
            Database Management
            
        </a>
        
    </li>

                    
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.ready-to-run/" class="dd-item 
     
    parent">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.ready-to-run/">
            Ready to RUN
            
        </a>
        
            
            
            
                <ul>
                
                
                    
                        
    
    

    <li data-nav-id="/getting-started/getting-started.installation.ready-to-run.docker-compose/" class="dd-item 
    active 
    ">
        <a href="https://ovh.github.com/cds/getting-started/getting-started.installation.ready-to-run.docker-compose/">
            Docker Compose
            
        </a>
        
            
            
            
        
    </li>

                    
                
                </ul>
             
        
    </li>

                    
                
                </ul>
             
        
    </li>

                    
                
                </ul>
             
        
    </li>

        
            
    
    

    <li data-nav-id="/building-pipelines/building-pipelines/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/building-pipelines/building-pipelines/">
            Building Pipelines
            
        </a>
        
    </li>

        
            
    
    

    <li data-nav-id="/advanced/advanced/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/advanced/advanced/">
            Advanced
            
        </a>
        
    </li>

        
            
    
    

    <li data-nav-id="/tutorials/tutorials/" class="dd-item 
     
    ">
        <a href="https://ovh.github.com/cds/tutorials/tutorials/">
            Tutorials
            
        </a>
        
    </li>

        

        

        
        
        
    </ul>
    
     
    <section id="footer">
      
    </section>
  </div>
</nav>



        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">
        
          <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/ovh/cds/edit/master/docs/build/content/getting-started/getting-started.installation.ready-to-run.docker-compose.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">

                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                  <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>

                      <a href="https://ovh.github.com/cds"> 
                      <span class="fa fa-arrow-circle-right" style="font-size:larger" aria-hidden="true"></span> 
                      CDS Documentation</a> 
                      
                         / <a href='https://ovh.github.com/cds/getting-started/getting-started/'>Getting started</a> / <a href='https://ovh.github.com/cds/getting-started/getting-started.installation/'>Installation</a> / <a href='https://ovh.github.com/cds/getting-started/getting-started.installation.ready-to-run/'>Ready to RUN</a> / <a href='https://ovh.github.com/cds/getting-started/getting-started.installation.ready-to-run.docker-compose/'>Docker Compose</a>
                      
                      
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#run-with-docker-compose">Run with Docker-Compose</a></li>
<li><a href="#how-to-run">How to run</a></li>
<li><a href="#prepare-project-pipeline-and-application">Prepare Project, Pipeline and Application</a></li>
<li><a href="#run-pipeline">Run Pipeline</a></li>
<li><a href="#hatchery-docker-swarm">Hatchery Docker Swarm</a></li>
<li><a href="#next-with-actions-plugins-and-templates">Next with Actions, Plugins and Templates</a></li>
</ul></li>
<li><a href="#go-further">Go further</a></li>
</ul>
</nav>
    </div>
</div>

            </div>
        
              
            <div id="body-inner">
              
              <h1>Docker Compose</h1>
                




<h2 id="run-with-docker-compose">Run with Docker-Compose</h2>

<p>The <a href="https://github.com/ovh/cds/blob/master/docker-compose.yml">docker-compose.yml</a> contains:</p>

<ul>
<li>cds-db service with a postgresql</li>
<li>cds-cache service with a redis</li>
<li>cds-migrate service to prepare DB tables.</li>
<li>cds-api service</li>
<li>cds-ui service</li>
<li>cds-hatchery-swarm service</li>
<li>cds-hatchery-local service</li>
</ul>

<p>Docker compose is very convenient to launch CDS for testing it. But this is not recommended for a Production Installation.</p>

<h2 id="how-to-run">How to run</h2>

<pre><code class="language-bash">$ git clone https://github.com/ovh/cds.git
$ cd cds
$ export HOSTNAME=$(hostname)

# Create PG Database
$ docker-compose up --no-recreate -d cds-db

# check if db is UP
# check if last log is &quot;LOG:  database system is ready to accept connections&quot;
$ docker-compose logs

$ docker-compose up --no-recreate cds-migrate
# You should have this log: &quot;cds_cds-migrate_1 exited with code 0&quot;

# run API and UI
$ docker-compose up cds-api cds-ui

</code></pre>

<p>Open a browser on <a href="http://localhost:2015">http://localhost:2015</a>, then register a new user.
As there is no SMTP server configured in docker-compose.yml file,
run <code>docker-compose logs</code> to get URL for validate the registration.</p>

<h2 id="prepare-project-pipeline-and-application">Prepare Project, Pipeline and Application</h2>

<p>On UI <a href="http://localhost:2015:">http://localhost:2015:</a></p>

<ul>
<li>Create a project</li>
<li>Create an application, with an void pipeline</li>
<li>Create a pipeline, attached to application</li>
<li>On Pipeline, add a stage and a job</li>
<li>Inside job, add a step of type &ldquo;script&rdquo;</li>
<li>In script content, add theses lines:</li>
</ul>

<pre><code class="language-bash">#!/bin/bash
set -ex
echo &quot;foo&quot;
sleep 10
echo &quot;bar&quot;
</code></pre>

<h2 id="run-pipeline">Run Pipeline</h2>

<p>Run pipeline. As you can see now, you pipeline is in &ldquo;waiting status&rdquo;. You have
to run a CDS Worker or a CDS Hatchery which aims to create workers.</p>

<p>Let&rsquo;s run an hatchery with docker-compose.</p>

<p>We will spawn a containers with a hatchery in <code>local</code> mode. Workers will be spawn inside this container.</p>

<pre><code class="language-bash">$ docker-compose up cds-hatchery-local
</code></pre>

<p><em>Running a hatchery &ldquo;local&rdquo; in a container is not recommanded. Use this way only for test purpose</em>.</p>

<p>After running this Hatchery, a worker will be spawned. Your pipeline will be in &ldquo;Building&rdquo;, then &ldquo;Success&rdquo; status.</p>

<h2 id="hatchery-docker-swarm">Hatchery Docker Swarm</h2>

<p>The <a href="https://ovh.github.com/cds/docker-compose.yml">docker-compose.yml</a> runs hatchery belonging to the <code>shared.infra</code> groups.</p>

<p>A <code>local hatchery</code> spawn worker on same host than hatchery. This is usually useful for specific cases, as
running job on specific hardware.
But this hatchery does not make it possible to respect the isolation of workpaces
of workers as they share the same workspace.</p>

<p>There is another hatchery configured in <a href="https://ovh.github.com/cds/docker-compose.yml">docker-compose.yml</a> file: a &lsquo;swarm hatchery&rsquo;</p>

<p>Please check that your docker installation allows docker API calls on <code>tcp://${HOSTNAME}:2375</code>
Otherwise, please update environment variable <code>DOCKER_HOST: tcp://${HOSTNAME}:2375</code> in
<a href="https://ovh.github.com/cds/docker-compose.yml">docker-compose.yml</a></p>

<pre><code class="language-bash">$ docker-compose up cds-hatchery-swarm
</code></pre>

<p>A <code>swarm hatchery</code> spwan CDS Worker inside dedicated container.
This ensures isolation of the workspaces and resources.</p>

<h2 id="next-with-actions-plugins-and-templates">Next with Actions, Plugins and Templates</h2>

<ul>
<li>You can download CDS CLI from <a href="https://github.com/ovh/cds/releases">https://github.com/ovh/cds/releases</a></li>

<li><p>Run:</p>

<pre><code class="language-bash">$ mv cds-linux-amd64 cds
$ chmod +x cds
$ ./cds login
# enter: http://${HOSTNAME}:8081 as CDS Endpoint
</code></pre></li>

<li><p>Import actions, example:</p>

<pre><code class="language-bash">$ cds action add --url https://raw.githubusercontent.com/ovh/cds/master/contrib/actions/cds-docker-package.hcl
</code></pre></li>

<li><p>Import plugins, example:</p>

<pre><code class="language-bash"># download plugin-download-linux-amd64 from  https://github.com/ovh/cds/releases
$ cds admin plugin add ./plugin-download-linux-amd64
</code></pre></li>

<li><p>Import templates, example:</p>

<pre><code class="language-bash"># download cds-template-plain-linux-amd64 from  https://github.com/ovh/cds/releases
$ cds admin templates add ./cds-template-plain-linux-amd64
</code></pre></li>
</ul>

<h1 id="go-further">Go further</h1>

<ul>
<li>First pipeline with CDS CLI <a href="https://ovh.github.com/cds/ddoc/tutorials/first-pipeline.md">read more</a></li>
<li>How to use Openstack infrastructure to spawn CDS container <a href="https://ovh.github.com/cds/doc/tutorials/hatchery-openstack.md">read more</a></li>
<li>Link CDS to a repository manager, as Github or Bitbucket <a href="https://ovh.github.com/cds/doc/tutorials/link-cds-to-reposmanager.md">read more</a></li>
<li>Learn more about CDS variables <a href="https://ovh.github.com/cds/doc/tutorials/variables.md">read more</a></li>
</ul>


<footer class=" footline" >
	
</footer>



      </div>
    </div>

    
 
    

    <div id="navigation">
        

          
        
              
            
                
                    
                    
                
            

            
            
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ovh.github.com/cds/js/clipboard.min.js"></script>
    <script src="https://ovh.github.com/cds/js/perfect-scrollbar.min.js"></script>
    <script src="https://ovh.github.com/cds/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://ovh.github.com/cds/js/jquery.sticky-kit.min.js"></script>
    <script src="https://ovh.github.com/cds/js/featherlight.min.js"></script>
    <script src="https://ovh.github.com/cds/js/html5shiv-printshiv.min.js"></script>
    <script src="https://ovh.github.com/cds/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ovh.github.com/cds/js/modernizr.custom.71422.js"></script>
    <script src="https://ovh.github.com/cds/js/learn.js"></script>
    <script src="https://ovh.github.com/cds/js/hugo-learn.js"></script>

    
    <link href="https://ovh.github.com/cds/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="https://ovh.github.com/cds/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>

